var searchObj;

//Cookies Plugin
jQuery(document).ready(function() { !function(e){if("function"==typeof define&&define.amd)define(e);else if("object"==typeof exports)module.exports=e();else{var n=window.Cookies,o=window.Cookies=e(window.jQuery);o.noConflict=function(){return window.Cookies=n,o}}}(function(){function e(){for(var e=0,n={};e<arguments.length;e++){var o=arguments[e];for(var t in o)n[t]=o[t]}return n}function n(o){function t(n,r,i){var c;if(arguments.length>1){if(i=e({path:"/"},t.defaults,i),"number"==typeof i.expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*i.expires),i.expires=s}try{c=JSON.stringify(r),/^[\{\[]/.test(c)&&(r=c)}catch(a){}return r=encodeURIComponent(String(r)),r=r.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=encodeURIComponent(String(n)),n=n.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),n=n.replace(/[\(\)]/g,escape),document.cookie=[n,"=",r,i.expires&&"; expires="+i.expires.toUTCString(),i.path&&"; path="+i.path,i.domain&&"; domain="+i.domain,i.secure&&"; secure"].join("")}n||(c={});for(var p=document.cookie?document.cookie.split("; "):[],u=/(%[0-9A-Z]{2})+/g,d=0;d<p.length;d++){var f=p[d].split("="),l=f[0].replace(u,decodeURIComponent),m=f.slice(1).join("=");if('"'===m.charAt(0)&&(m=m.slice(1,-1)),m=o&&o(m,l)||m.replace(u,decodeURIComponent),this.json)try{m=JSON.parse(m)}catch(a){}if(n===l){c=m;break}n||(c[l]=m)}return c}return t.get=t.set=t,t.getJSON=function(){return t.apply({json:!0},[].slice.call(arguments))},t.defaults={},t.remove=function(n,o){t(n,"",e(o,{expires:-1}))},t.withConverter=n,t}return n()});});

//Modal Plugin
jQuery(document).ready(function() { (function($){$.fn.extend({leanModal:function(options){var defaults={top:100,overlay:0.5,closeButton:null};var overlay=$("<div id='lean_overlay'></div>");$("body").append(overlay);options=$.extend(defaults,options);return this.each(function(){var o=options;$(this).click(function(e){var modal_id=$(this).attr("href");$("#lean_overlay").click(function(){close_modal(modal_id)});$(o.closeButton).click(function(){close_modal(modal_id)});var modal_height=$(modal_id).outerHeight();var modal_width=$(modal_id).outerWidth();
    $("#lean_overlay").css({"display":"block",opacity:0});$("#lean_overlay").fadeTo(200,o.overlay);$(modal_id).css({"display":"block","position":"fixed","opacity":0,"z-index":11000,"top":o.top+"px"});$(modal_id).fadeTo(200,1);e.preventDefault()})});function close_modal(modal_id){$("#lean_overlay").fadeOut(200);$(modal_id).css({"display":"none"})}}})})(jQuery);});

jQuery(document).ready(function() {
    var Cookies2 = Cookies.noConflict();
    var cookieValue = Cookies2.get('gridlist');
    jQuery('#list').click(function(event){event.preventDefault();
        Cookies2.remove('gridlist');
        Cookies2.set('gridlist', 'list');
        var cookieValue = Cookies2.get('gridlist');
        jQuery('#boat-list .boat').removeClass('col-lg-6 col-md-6 col-sm-6 grid-group-item');
        jQuery('#boat-list .boat').addClass('col-lg-12 col-md-12 col-sm-12 list-group-item');
        jQuery('#grid').removeClass('active');
        jQuery('#grid').addClass('inactive');
        jQuery('#list').removeClass('inactive');
        jQuery('#list').addClass('active');
    });
    jQuery('#grid').click(function(event){event.preventDefault();
        Cookies2.remove('gridlist');
        Cookies2.set('gridlist', 'grid');
        var cookieValue = Cookies2.get('gridlist');
        jQuery('#boat-list .boat').removeClass('col-lg-12 col-md-12 col-sm-12 list-group-item');
        jQuery('#boat-list .boat').addClass('col-lg-6 col-md-6 col-sm-6 grid-group-item');
        jQuery('#list').removeClass('active');
        jQuery('#list').addClass('inactive');
        jQuery('#grid').removeClass('inactive');
        jQuery('#grid').addClass('active');
    });
    if (cookieValue == 'grid') {
        jQuery('#boat-list .boat').removeClass('col-lg-12 col-md-12 col-sm-12 list-group-item');
        jQuery('#boat-list .boat').addClass('col-lg-6 col-md-6 col-sm-6 grid-group-item');
        jQuery('#list').removeClass('active');
        jQuery('#list').addClass('inactive');
        jQuery('#grid').removeClass('inactive');
        jQuery('#grid').addClass('active');
    } else {
        jQuery('#boat-list .boat').removeClass('col-lg-6 col-md-6 col-sm-6 grid-group-item');
        jQuery('#boat-list .boat').addClass('col-lg-12 col-md-12 col-sm-12 list-group-item');
        jQuery('#grid').removeClass('active');
        jQuery('#grid').addClass('inactive');
        jQuery('#list').removeClass('inactive');
        jQuery('#list').addClass('active');
    }
});

jQuery(document).ready(function() {
    jQuery('#show-search-button').click(function(event){event.preventDefault();
        jQuery('#boat-search').removeClass('hidden-xs');
        jQuery('#boat-search').addClass('col-xs-12');
        jQuery('#show-search').removeClass('col-xs-12');
        jQuery('#show-search').addClass('hidden-xs');
        jQuery('#hide-search').removeClass('hidden-xs');
        jQuery('#hide-search').addClass('col-xs-12');
        jQuery('#mobile-sort').toggle();
    });
    jQuery('#hide-search-button').click(function(event){event.preventDefault();
        jQuery('#boat-search').addClass('hidden-xs');
        jQuery('#boat-search').removeClass('col-xs-12');
        jQuery('#show-search').addClass('col-xs-12');
        jQuery('#show-search').removeClass('hidden-xs');
        jQuery('#hide-search').addClass('hidden-xs');
        jQuery('#hide-search').removeClass('col-xs-12');
        jQuery('#mobile-sort').toggle();
    });
    jQuery('#show-type').click(function(event){event.preventDefault();
        jQuery('#type-filter').toggle('slow');
    });
    jQuery('#show-condition').click(function(event){event.preventDefault();
        jQuery('#condition-filter').toggle('slow');
    });
    jQuery('#show-make').click(function(event){event.preventDefault();
        jQuery('#make-filter').toggle('slow');
    });
    jQuery('#show-model').click(function(event){event.preventDefault();
        jQuery('#model-filter').toggle('slow');
    });
    jQuery('#show-location').click(function(event){event.preventDefault();
        jQuery('#location-filter').toggle('slow');
    });
    jQuery('#show-makemodel').click(function(event){event.preventDefault();
        jQuery('#makemodel-filter').toggle('slow');
    });
    jQuery('#show-price').click(function(event){event.preventDefault();
        jQuery('#price-filter').toggle('slow');
    });
    jQuery('#show-length').click(function(event){event.preventDefault();
        jQuery('#length-filter').toggle('slow');
    });
    jQuery('#show-year').click(function(event){event.preventDefault();
        jQuery('#year-filter').toggle('slow');
    });
});


function SubmitForm(formId) {
    var oForm = document.getElementById("boat-search-form");
    if (oForm) {
        var price = document.getElementById("price");
        var currencyEl = document.getElementById("currency");
        var currency = currencyEl.options[currencyEl.selectedIndex].value;
        price.value = price + '|' + currency;
        oForm.submit();
    }
    else {
        alert("DEBUG - could not find element " + formId);
    }
}

function inventorysearch() 
{
    this.init = function(searchUri) {
    	this.basePath = searchUri;
        this.initEvents();
    };
    
    /**
     * Build search url and execute
     */
    this.submitSearch = function(isMobile) {
    	var redirectURL = '';
    	var formSelector = '.desktop-form ';
    	if(typeof(isMobile) != 'undefined' && isMobile == 1) {
    		formSelector = '.mobile-form ';
    	}
    	
    	requestParams = {
    		action: 'search_ajax',
    		data: {
    			// selectable via inputs
    			'make': jQuery(formSelector + '#makeandmodel').val(),
    			'min-price': jQuery(formSelector + '#minprice').val(),
    			'max-price': jQuery(formSelector + '#maxprice').val(),
    			'min-year': jQuery(formSelector + '#minyear').val(),
    			'max-year': jQuery(formSelector + '#maxyear').val(),
    			'min-length': jQuery(formSelector + '#minlength').val(),
    			'max-length': jQuery(formSelector + '#maxlength').val(),    			
    			'currency': jQuery(formSelector + '#currency').val(),
    			'unit': jQuery(formSelector + '#unit').val(),
    			
    			// selectable via links
    			'model': jQuery('#model').val(),
    			'category': jQuery('#category').val(),
    			'country': jQuery('#country').val(),
    			'state': jQuery('#state').val(),
    			'city': jQuery('#city').val(),
    			'category': jQuery('#category').val(),
    			'condition': jQuery('#condition').val(),
    			'sort': jQuery('#sort').val(),
    			'option': jQuery('#option').val(),
    			
    			// for every search we start at page 1
    			'start': 0
    		}
    	};
    	
    	jQuery.post(inventory_ajax_url, requestParams, function(url) {
    		window.location = url;
    	});
    };
    
    this.setSortOrder = function(sortOrder) {
    	jQuery('#sort').val(sortOrder);
    	this.submitSearch();
    	//window.location = encodeURI(query);
    };
    
    this.setBasePath = function(uri) {
    	this.basePath = uri;
    };
    
    this.validateSearch = function(selector) {
    	 $(selector).validate({
    		 rules: {
	    		 'min-price' : {
	    			 min: 0,
	    			 max: function() {
	    				 var maxval = parseInt($(selector + ' #maxprice').val()) || -1;
	    				 if(maxval == -1) {
	    					 maxval = 10000000000;
	    				 }
	    				 
	    				 return maxval;
	    			 }
	    		 }
    		 }
    	 });    	 
    }
    
    this.initEvents = function() {
    	
    	var context = this;
    	
    	// desktop search action
        jQuery("body").on("click", "#search-btn-desktop", function(e) {
        	//var isValid = context.validateSearch('form.desktop-form');
        	context.submitSearch();
        });	
        
        jQuery("body").on("click", "#search-btn-mobile", function(e) {
        	//var isValid = context.validateSearch('form.desktop-form');
        	context.submitSearch(true);
        });	        
        
        jQuery('#searchResults .form-control-desktop').keypress(function(e) {
            if (e.which == 13) {
            	//var isValid = context.validateSearch('form.desktop-form');
            	context.submitSearch();
            }
        });    
        
        jQuery('#searchResults .form-control-mobile').keypress(function(e) {
            if (e.which == 13) {
            	context.submitSearch(true);
            }
        });   
        
        jQuery('#searchResults span a').click(function() {
        	var id = jQuery(this).parent().parent().find('input').first().attr('id');
        	var isMobile = jQuery(this).closest('form').first().hasClass('mobile-form');
        	var formSelector = '.desktop-form ';
        	if(isMobile) {
        		formSelector = '.mobile-form ';
        	}
        	
        	jQuery(formSelector + '#' + id).val('');
        	context.submitSearch(isMobile);
        });        
    	
        jQuery("body").on("click", "#option-10", function(e) {
            var option = "10";
            jQuery('#option').val(option);
            context.submitSearch();
        });
        jQuery("body").on("click", "#option-100", function(e) {
            var option = "100";
            jQuery('#option').val(option);
            context.submitSearch();
        });
        
        jQuery("body").on("change", ".sort-dropdown", function(e) {
        	context.setSortOrder($(this).val());
        });  
    };

    return this;
}

function showFacet(key) {
    jQuery('.facetgroup').each(function(index) {
        if (this.id == 'fieldset_' + key) {
            this.style.display = 'block';
        } else {
            this.style.display = 'none';
        }
    });
}

jQuery(document).ready(function() {
    jQuery('a[rel*=leanModal]').leanModal({
        top : 200,
        closeButton: ".modal_close"
    });
});
